# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æã‚·ã‚¹ãƒ†ãƒ æŠ€è¡“ä»•æ§˜æ›¸

## æ¦‚è¦

MVVæŠ½å‡ºã‚·ã‚¹ãƒ†ãƒ ã®5ã¤ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†ææ©Ÿèƒ½ã¨Visual Analytics Galleryã®æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã«ã¤ã„ã¦è©³è¿°ã—ã¾ã™ã€‚

**Phase 3å®Œäº†çŠ¶æ³** (2025-07-13):
- âœ… **5ã¤ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†ææ©Ÿèƒ½**: é¡ä¼¼ä¼æ¥­æ¤œç´¢ã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã€ãƒ¯ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¦ãƒ‰ã€ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ãƒãƒƒãƒ—ã€ç‹¬è‡ªæ€§åˆ†æã€å“è³ªè©•ä¾¡
- âœ… **Visual Analytics Gallery**: é«˜å“è³ªã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ + Excelçµ±åˆ
- âœ… **Professional Excel Export**: 5+å°‚é–€ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ + ç”»åƒãƒ¬ãƒãƒ¼ãƒˆ
- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–è¨ˆç®—ã€<1ç§’å¿œç­”æ™‚é–“

## 1. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 å…¨ä½“æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5 Analysis Tabs â”‚â—„â”€â”€â–ºâ”‚   Analysis Store â”‚â—„â”€â”€â–ºâ”‚   IndexedDB     â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ â€¢ SimilarFinder â”‚    â”‚ â€¢ Real-time calc â”‚    â”‚ â€¢ Company data  â”‚
â”‚ â€¢ TrendAnalysis â”‚    â”‚ â€¢ LRU Cache      â”‚    â”‚ â€¢ Embeddings    â”‚
â”‚ â€¢ WordCloud     â”‚    â”‚ â€¢ Progress mgmt  â”‚    â”‚ â€¢ Similarity    â”‚
â”‚ â€¢ Positioning   â”‚    â”‚ â€¢ State sync     â”‚    â”‚ â€¢ Screenshots   â”‚
â”‚ â€¢ Uniqueness    â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ â€¢ QualityAssess â”‚    â”‚                  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser Runtime Environment                    â”‚
â”‚  â€¢ TinySegmenter (å½¢æ…‹ç´ è§£æ)                                      â”‚
â”‚  â€¢ OpenAI Embeddings (text-embedding-3-small)                   â”‚
â”‚  â€¢ Cosine Similarity + MDS Algorithm                            â”‚
â”‚  â€¢ Screenshot Capture (html2canvas)                             â”‚
â”‚  â€¢ Excel Processing (ExcelJS)                                   â”‚
â”‚  â€¢ Base64 â†” ArrayBuffer Conversion                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Visual Analytics Gallery                      â”‚
â”‚  â€¢ High-quality Screenshot Capture (2100Ã—1350px)               â”‚
â”‚  â€¢ TabID-based Organization                                     â”‚
â”‚  â€¢ IndexedDB Persistent Storage                                 â”‚
â”‚  â€¢ Excel Multi-sheet Export                                     â”‚
â”‚  â€¢ Browser-compatible Image Processing                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
1. **ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿**: IndexedDBã‹ã‚‰ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ãƒ»åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«å¿œã˜ã¦é¡ä¼¼åº¦ãƒ»ç‹¬è‡ªæ€§ã‚¹ã‚³ã‚¢ãƒ»å“è³ªè©•ä¾¡ã‚’å‹•çš„è¨ˆç®—
3. **çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥**: LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§è¨ˆç®—çµæœã‚’ä¿å­˜ï¼ˆ50%+ãƒ’ãƒƒãƒˆç‡ï¼‰
4. **UIæ›´æ–°**: ReactçŠ¶æ…‹ç®¡ç†ã«ã‚ˆã‚‹å³åº§ã®ç”»é¢åæ˜ 
5. **Visual Analytics**: åˆ†æç”»é¢ã®é«˜å“è³ªã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè‡ªå‹•ã‚­ãƒ£ãƒ—ãƒãƒ£
6. **Excelçµ±åˆ**: TabIDåˆ¥ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã«ã‚ˆã‚‹å¤šã‚·ãƒ¼ãƒˆExcelãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## 2. ãƒ‡ãƒ¼ã‚¿ç®¡ç†

### 2.1 IndexedDBã‚¹ã‚­ãƒ¼ãƒ
```typescript
interface CompanyData {
  id: string;
  name: string;
  category: string;
  mission?: string;
  vision?: string;
  values?: string;
  embeddings?: number[];  // 1536æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ« (OpenAI text-embedding-3-small)
  companyInfo?: CompanyInfo;
  createdAt: Date;
  updatedAt: Date;
}

interface SimilarityCache {
  companyId: string;
  targetId: string;
  similarity: number;
  algorithm: 'embedding' | 'morphological' | 'combined';
  computedAt: Date;
}

// Visual Analytics Gallery (æ–°æ©Ÿèƒ½)
interface ScreenshotMetadata {
  id: string;                    // ä¸€æ„è­˜åˆ¥å­
  timestamp: number;             // ä½œæˆæ—¥æ™‚
  name: string;                  // ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å
  description: string;           // èª¬æ˜
  tabId: string;                 // åˆ†æã‚¿ãƒ–ID (finder, trends, wordcloud, positioning, uniqueness, quality)
  width: number;                 // ç”»åƒå¹…
  height: number;                // ç”»åƒé«˜ã•
  size: number;                  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º (bytes)
}

interface ScreenshotData {
  id: string;                    // metadataã¨ã®é–¢é€£ä»˜ã‘
  data: string;                  // Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ‡ãƒ¼ã‚¿
}

// ç‹¬è‡ªæ€§åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ (æ–°æ©Ÿèƒ½)
interface UniquenessCache {
  companyId: string;
  baseScore: number;             // åŸºæœ¬ç‹¬è‡ªæ€§ã‚¹ã‚³ã‚¢
  industryScore: number;         // æ¥­ç•Œå†…ç›¸å¯¾ã‚¹ã‚³ã‚¢
  crossIndustryScore: number;    // æ¥­ç•Œé–“ã‚¹ã‚³ã‚¢
  rarityScore: number;           // å¸Œå°‘æ€§ã‚¹ã‚³ã‚¢
  finalScore: number;            // æœ€çµ‚çµ±åˆã‚¹ã‚³ã‚¢
  computedAt: Date;
}

// å“è³ªè©•ä¾¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (æ–°æ©Ÿèƒ½)
interface QualityCache {
  companyId: string;
  comprehensiveness: number;     // åŒ…æ‹¬æ€§ã‚¹ã‚³ã‚¢
  specificity: number;           // å…·ä½“æ€§ã‚¹ã‚³ã‚¢
  consistency: number;           // ä¸€è²«æ€§ã‚¹ã‚³ã‚¢
  overallQuality: number;        // ç·åˆå“è³ªã‚¹ã‚³ã‚¢
  suggestions: string[];         // æ”¹å–„ææ¡ˆ
  computedAt: Date;
}
```

### 2.2 ãƒ‡ãƒ¼ã‚¿åŒæœŸæˆ¦ç•¥
- **å³åº§æ›´æ–°**: ä¼æ¥­ãƒ‡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã®å³åº§åæ˜ 
- **å·®åˆ†æ›´æ–°**: å¤‰æ›´ã®ã‚ã£ãŸãƒ‡ãƒ¼ã‚¿ã®ã¿å†è¨ˆç®—  
- **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†**: UIãƒ–ãƒ­ãƒƒã‚¯ã‚’é¿ã‘ãŸéåŒæœŸå‡¦ç†
- **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç®¡ç†**: è‡ªå‹•LRUå‰Šé™¤ï¼ˆ50ä»¶ä¸Šé™ï¼‰ã¨TabIDåˆ†é¡
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–**: ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã®é–¢é€£ã‚­ãƒ£ãƒƒã‚·ãƒ¥è‡ªå‹•å‰Šé™¤
- **Excelçµ±åˆåŒæœŸ**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ä¿è¨¼

## 2.3 å®Ÿè£…æ¸ˆã¿5ã¤ã®åˆ†ææ©Ÿèƒ½

### 1. é¡ä¼¼ä¼æ¥­æ¤œç´¢ï¼ˆSimilar Company Finderï¼‰
```typescript
interface SimilarCompanyResult {
  company: CompanyData;
  similarity: number;
  reasons: SimilarityReason[];
  commonKeywords: string[];
  industryMatch: boolean;
}

// ç‰¹å¾´
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é¡ä¼¼åº¦è¨ˆç®—ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
- è©³ç´°ãªé¡ä¼¼ç†ç”±èª¬æ˜ï¼ˆã‚¿ã‚°ãƒ™ãƒ¼ã‚¹åˆ†æï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¨Markdownã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
- è¤‡åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆembedding 70% + morphological 25% + industry bonus 5%ï¼‰
```

### 2. ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆMVV Trend Analysisï¼‰
```typescript
interface TrendAnalysisResult {
  industryTrends: Map<string, KeywordFrequency[]>;
  timeSeriesData: TimeSeriesTrend[];
  categoryBreakdown: CategoryAnalysis;
  insights: TrendInsight[];
}

// ç‰¹å¾´  
- JSICæ¥­ç•Œåˆ†é¡ã«ã‚ˆã‚‹ç²¾å¯†ãªæ¥­ç•Œåˆ¥åˆ†æ
- TinySegmenterå½¢æ…‹ç´ è§£æã«ã‚ˆã‚‹æ—¥æœ¬èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
- æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã¨æ¥­ç•Œæ¯”è¼ƒ
- å¤šæ¬¡å…ƒãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ¥­ç•Œãƒ»æœŸé–“ãƒ»é »åº¦ï¼‰
```

### 3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆWord Cloud Dashboardï¼‰
```typescript
interface WordCloudData {
  words: WordFrequency[];
  categories: CategoryFilter[];
  interactionMode: 'hover' | 'click' | 'drag';
  zoomLevel: number;
}

// ç‰¹å¾´
- ç‹¬ç«‹ã‚¿ãƒ–ã§ã®ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º
- ã‚ºãƒ¼ãƒ /ãƒ‘ãƒ³/ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ä»˜ãã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–UI  
- MVVã‚¿ã‚¤ãƒ—ãƒ»æ¥­ç•Œã‚«ãƒ†ã‚´ãƒªãƒ»é »åº¦ã«ã‚ˆã‚‹å¤šæ¬¡å…ƒãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- é«˜é€Ÿãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆCanvas-basedï¼‰
```

### 4. ç«¶åˆãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ãƒãƒƒãƒ—ï¼ˆCompetitive Positioning Mapï¼‰
```typescript
interface PositioningMapData {
  positions: CompanyPosition[];
  clusters: IndustryCluster[];
  viewport: ViewportConfig;
  interactions: InteractionState;
}

// ç‰¹å¾´
- MDSï¼ˆå¤šæ¬¡å…ƒå°ºåº¦æ³•ï¼‰ã«ã‚ˆã‚‹2æ¬¡å…ƒç©ºé–“ãƒãƒƒãƒ”ãƒ³ã‚°
- æ¥­ç•Œãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ãƒ‰ãƒ©ãƒƒã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- ä¼æ¥­è©³ç´°ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¨ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†æ
- SVGãƒ™ãƒ¼ã‚¹é«˜å“è³ªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
```

### 5. ç‹¬è‡ªæ€§åˆ†æï¼ˆUniqueness Analysis Î²ï¼‰
```typescript
interface UniquenessAnalysis {
  baseScore: number;        // åŸºæœ¬ç‹¬è‡ªæ€§ (30%)
  industryScore: number;    // æ¥­ç•Œå†…ç›¸å¯¾ (40%)  
  crossIndustryScore: number; // æ¥­ç•Œé–“æ¯”è¼ƒ (20%)
  rarityScore: number;      // å¸Œå°‘æ€§è©•ä¾¡ (10%)
  finalScore: number;       // çµ±åˆã‚¹ã‚³ã‚¢
  breakdown: ScoreBreakdown;
}

// ç‰¹å¾´
- å¤šè¦ç´ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆåŸºæœ¬+æ¥­ç•Œå†…+æ¥­ç•Œé–“+å¸Œå°‘æ€§ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¨ã‚¹ã‚³ã‚¢åˆ†è§£è¡¨ç¤º
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆLRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- è©³ç´°ãªè¨ˆç®—æ ¹æ‹ ã®å¯è¦–åŒ–
```

### 6. å“è³ªè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆQuality Assessment Î²ï¼‰
```typescript
interface QualityAssessment {
  comprehensiveness: number;  // åŒ…æ‹¬æ€§ (0-100)
  specificity: number;        // å…·ä½“æ€§ (0-100)
  consistency: number;        // ä¸€è²«æ€§ (0-100)
  overallQuality: number;     // ç·åˆå“è³ª
  suggestions: Suggestion[];   // æ”¹å–„ææ¡ˆ
  benchmarks: QualityBenchmark[];
}

// ç‰¹å¾´
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹MVVå“è³ªè©•ä¾¡
- åŒ…æ‹¬æ€§ãƒ»å…·ä½“æ€§ãƒ»ä¸€è²«æ€§ã®3è»¸è©•ä¾¡
- æ”¹å–„ææ¡ˆã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æ¯”è¼ƒ
- æ¥­ç•Œãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ©Ÿèƒ½
```

## 3. è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### 3.1 é¡ä¼¼åº¦è¨ˆç®—ã®çµ„ã¿åˆã‚ã›
```typescript
function calculateCombinedSimilarity(
  company1: CompanyData, 
  company2: CompanyData
): number {
  const embeddingSim = calculateEmbeddingSimilarity(
    company1.embeddings, 
    company2.embeddings
  ); // 70%ã®é‡ã¿
  
  const morphologicalSim = calculateMorphologicalSimilarity(
    company1, 
    company2
  ); // 25%ã®é‡ã¿
  
  const industryBonus = company1.category === company2.category ? 0.1 : 0; // 15%ã®é‡ã¿
  
  return embeddingSim * 0.7 + morphologicalSim * 0.25 + industryBonus * 0.15;
}
```

### 3.2 åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«é¡ä¼¼åº¦
```typescript
function calculateEmbeddingSimilarity(vec1: number[], vec2: number[]): number {
  if (!vec1 || !vec2 || vec1.length !== vec2.length) return 0;
  
  // ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã®è¨ˆç®—
  const dotProduct = vec1.reduce((sum, a, i) => sum + a * vec2[i], 0);
  const magnitude1 = Math.sqrt(vec1.reduce((sum, a) => sum + a * a, 0));
  const magnitude2 = Math.sqrt(vec2.reduce((sum, a) => sum + a * a, 0));
  
  if (magnitude1 === 0 || magnitude2 === 0) return 0;
  
  return Math.max(0, Math.min(1, dotProduct / (magnitude1 * magnitude2)));
}
```

### 3.3 å½¢æ…‹ç´ è§£æã«ã‚ˆã‚‹é¡ä¼¼åº¦
```typescript
function calculateMorphologicalSimilarity(
  company1: CompanyData, 
  company2: CompanyData
): number {
  const segmenter = new TinySegmenter();
  
  // MVVãƒ†ã‚­ã‚¹ãƒˆã®çµåˆã¨å½¢æ…‹ç´ è§£æ
  const text1 = [company1.mission, company1.vision, company1.values]
    .filter(Boolean).join(' ');
  const text2 = [company2.mission, company2.vision, company2.values]
    .filter(Boolean).join(' ');
    
  const keywords1 = new Set(segmenter.segment(text1)
    .filter(word => word.length >= 2 && !STOP_WORDS.includes(word)));
  const keywords2 = new Set(segmenter.segment(text2)
    .filter(word => word.length >= 2 && !STOP_WORDS.includes(word)));
  
  // Jaccardä¿‚æ•°ã«ã‚ˆã‚‹é¡ä¼¼åº¦è¨ˆç®—
  const intersection = new Set([...keywords1].filter(x => keywords2.has(x)));
  const union = new Set([...keywords1, ...keywords2]);
  
  return union.size > 0 ? intersection.size / union.size : 0;
}
```

## 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 4.1 LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ 
```typescript
class SimilarityCache {
  private cache = new Map<string, CacheEntry>();
  private maxSize = 10000;
  
  get(key: string): number | null {
    const entry = this.cache.get(key);
    if (!entry) return null;
    
    // LRU: ã‚¢ã‚¯ã‚»ã‚¹é †åºã‚’æ›´æ–°
    this.cache.delete(key);
    this.cache.set(key, entry);
    
    return entry.similarity;
  }
  
  set(company1: string, company2: string, similarity: number): void {
    const key = this.generateKey(company1, company2);
    
    // å®¹é‡åˆ¶é™: å¤ã„ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    
    this.cache.set(key, {
      similarity,
      timestamp: Date.now()
    });
  }
  
  private generateKey(id1: string, id2: string): string {
    // å¯¾ç§°æ€§ã‚’åˆ©ç”¨: å¸¸ã«è¾æ›¸é †ã§ã‚­ãƒ¼ã‚’ç”Ÿæˆ
    return id1 < id2 ? `${id1}_${id2}` : `${id2}_${id1}`;
  }
}
```

### 4.2 ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–è¨ˆç®—
```typescript
class ProgressiveCalculator {
  private pendingCalculations = new Set<string>();
  
  async calculateSimilarityMatrix(companies: CompanyData[]): Promise<number[][]> {
    const matrix = this.initializeMatrix(companies.length);
    
    // Phase 1: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸçµæœã‚’ä½¿ç”¨
    this.loadCachedResults(matrix, companies);
    
    // Phase 2: æœªè¨ˆç®—ã®é¡ä¼¼åº¦ã‚’æ®µéšçš„ã«è¨ˆç®—
    await this.calculateMissingEntries(matrix, companies);
    
    return matrix;
  }
  
  private async calculateMissingEntries(
    matrix: number[][], 
    companies: CompanyData[]
  ): Promise<void> {
    const batchSize = 50; // ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’åˆ¶é™ã—ã¦UIãƒ–ãƒ­ãƒƒã‚¯ã‚’é˜²æ­¢
    let processed = 0;
    
    for (let i = 0; i < companies.length; i++) {
      for (let j = i + 1; j < companies.length; j++) {
        if (matrix[i][j] === -1) { // æœªè¨ˆç®—
          matrix[i][j] = matrix[j][i] = this.calculateSimilarity(
            companies[i], 
            companies[j]
          );
          
          processed++;
          if (processed % batchSize === 0) {
            // UIã®å¿œç­”æ€§ã‚’ä¿ã¤ãŸã‚å®šæœŸçš„ã«åˆ¶å¾¡ã‚’æˆ»ã™
            await new Promise(resolve => setTimeout(resolve, 0));
          }
        }
      }
    }
  }
}
```

### 4.3 ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
- **é…å»¶èª­ã¿è¾¼ã¿**: å¿…è¦ãªæ™‚ç‚¹ã§ã®ã¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
- **ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åŒ–**: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®éƒ¨åˆ†è¡¨ç¤º
- **å®šæœŸçš„ãªã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**: ä¸è¦ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ãƒˆãƒªã®å‰Šé™¤

## 5. UIçµ±åˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£

### 5.1 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨ˆç®—
```typescript
// Debounced calculation for user interactions
const debouncedCalculation = useMemo(
  () => debounce((query: string) => {
    startCalculation(query);
  }, 300),
  []
);

// Progress tracking for long calculations
const [progress, setProgress] = useState<CalculationProgress>({
  current: 0,
  total: 0,
  stage: 'idle'
});
```

### 5.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **Graceful Degradation**: åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ãŒãªã„å ´åˆã®ä»£æ›¿å‡¦ç†
- **éƒ¨åˆ†çš„å¤±æ•—ã®å‡¦ç†**: ä¸€éƒ¨ä¼æ¥­ã®è¨ˆç®—ã‚¨ãƒ©ãƒ¼ãŒå…¨ä½“ã«å½±éŸ¿ã—ãªã„è¨­è¨ˆ
- **ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹**: ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹è‡ªå‹•å†è©¦è¡Œ

## 6. ãƒ‡ãƒãƒƒã‚°ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### 6.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
```typescript
class PerformanceMonitor {
  private metrics = new Map<string, PerformanceEntry>();
  
  startTimer(operation: string): void {
    this.metrics.set(operation, {
      startTime: performance.now(),
      operation
    });
  }
  
  endTimer(operation: string): number {
    const entry = this.metrics.get(operation);
    if (!entry) return 0;
    
    const duration = performance.now() - entry.startTime;
    console.log(`ğŸ”¥ ${operation}: ${Math.round(duration)}ms`);
    
    this.metrics.delete(operation);
    return duration;
  }
}
```

### 6.2 ãƒ‡ãƒãƒƒã‚°æƒ…å ±
- **è¨ˆç®—ã‚¹ãƒ†ãƒƒãƒ—ã®å¯è¦–åŒ–**: å„æ®µéšã®ä¸­é–“çµæœè¡¨ç¤º
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ã®ç›£è¦–
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒ¢ãƒªç›£è¦–

## 7. å°†æ¥ã®æ‹¡å¼µæ€§

### 7.1 ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
- **Web Workers**: é‡ã„è¨ˆç®—å‡¦ç†ã®ä¸¦åˆ—åŒ–
- **ServiceWorker**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†
- **WebAssembly**: é«˜é€Ÿæ•°å€¤è¨ˆç®—ã®å°å…¥

### 7.2 æ–°æ©Ÿèƒ½å¯¾å¿œ
- **å‹•çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: è¨­å®šå¯èƒ½ãªé¡ä¼¼åº¦è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®è©•ä¾¡æŒ‡æ¨™
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å”èª¿**: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹åŒæ™‚åˆ†æ

## 8. Visual Analytics Gallery

### 8.1 ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ã‚·ã‚¹ãƒ†ãƒ 
```typescript
interface ScreenshotCapture {
  captureElement: (selector: string, options: CaptureOptions) => Promise<string>;
  optimizeImage: (data: string, options: OptimizeOptions) => Promise<string>;
  validateImage: (data: string) => boolean;
}

interface CaptureOptions {
  width: number;          // 2100px (é«˜è§£åƒåº¦)
  height: number;         // 1350px
  quality: number;        // 0.95 (é«˜å“è³ª)
  format: 'png' | 'jpeg'; // PNGæ¨å¥¨
  backgroundColor: string; // èƒŒæ™¯è‰²æŒ‡å®š
}
```

### 8.2 IndexedDBæ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
```typescript
class ScreenshotStorage {
  // åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒª
  async countByTabId(tabId: string): Promise<number> {
    return await this.db.screenshots.where('tabId').equals(tabId).count();
  }
  
  // LRUè‡ªå‹•å‰Šé™¤ï¼ˆ50ä»¶ä¸Šé™ï¼‰
  async maintainStorageLimit(): Promise<void> {
    const total = await this.db.screenshots.count();
    if (total > 50) {
      const excess = total - 50;
      await this.db.screenshots.orderBy('timestamp').limit(excess).delete();
    }
  }
  
  // TabIDåˆ¥å–å¾—
  async getByTabId(tabId: string): Promise<ScreenshotMetadata[]> {
    return await this.db.screenshots
      .where('tabId').equals(tabId)
      .reverse()
      .sortBy('timestamp');
  }
}
```

### 8.3 Excelçµ±åˆã‚·ã‚¹ãƒ†ãƒ 
```typescript
class ExcelImageIntegration {
  // ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›ç”»åƒå¤‰æ›
  private base64ToArrayBuffer(base64: string): ArrayBuffer {
    const binaryString = atob(base64);
    const length = binaryString.length;
    const bytes = new Uint8Array(length);
    
    for (let i = 0; i < length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    
    return bytes.buffer; // ExcelJSäº’æ›
  }
  
  // TabIDåˆ¥ãƒãƒ«ãƒã‚·ãƒ¼ãƒˆç”Ÿæˆ
  async generateVisualAnalyticsSheets(screenshots: ScreenshotMetadata[]): Promise<ExcelSheet[]> {
    const groupedByTab = this.groupBy(screenshots, 'tabId');
    const sheets: ExcelSheet[] = [];
    
    for (const [tabId, tabScreenshots] of groupedByTab) {
      const sheet = await this.createTabSheet(tabId, tabScreenshots);
      sheets.push(sheet);
    }
    
    return sheets;
  }
}
```

### 8.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **éåŒæœŸã‚­ãƒ£ãƒ—ãƒãƒ£**: UIãƒ–ãƒ­ãƒƒã‚¯ã‚’é¿ã‘ãŸãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†
- **ç”»åƒåœ§ç¸®**: å“è³ªã‚’ä¿ã¡ãªãŒã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–
- **åŠ¹ç‡çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ãƒã‚¤ãƒ†ã‚£ãƒ–IndexedDB APIã«ã‚ˆã‚‹é«˜é€Ÿã‚¯ã‚¨ãƒª
- **ãƒ¡ãƒ¢ãƒªç®¡ç†**: è‡ªå‹•ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ50ä»¶ä¸Šé™ï¼‰

## 9. ç¾åœ¨ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å®Ÿç¸¾

### 9.1 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
| åˆ†ææ©Ÿèƒ½ | åˆå›è¨ˆç®— | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ | æœ€é©åŒ–ç›®æ¨™ | å®Ÿæ¸¬å€¤ |
|----------|---------|----------------|------------|--------|
| é¡ä¼¼ä¼æ¥­æ¤œç´¢ | <1ç§’ | <100ms | <2ç§’ | âœ… å¤§å¹…é”æˆ |
| ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ | <1ç§’ | <200ms | <3ç§’ | âœ… å¤§å¹…é”æˆ |
| ãƒ¯ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¦ãƒ‰ | <500ms | <50ms | <1ç§’ | âœ… é”æˆ |
| ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ãƒãƒƒãƒ— | <2ç§’ | <300ms | <5ç§’ | âœ… å¤§å¹…é”æˆ |
| ç‹¬è‡ªæ€§åˆ†æ | <1ç§’ | <150ms | <3ç§’ | âœ… å¤§å¹…é”æˆ |
| å“è³ªè©•ä¾¡ | <800ms | <100ms | <2ç§’ | âœ… é”æˆ |

### 9.2 Visual Analytics Gallery
| æ“ä½œ | å‡¦ç†æ™‚é–“ | æœ€é©åŒ–ç›®æ¨™ | å®Ÿæ¸¬å€¤ |
|------|---------|------------|--------|
| ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ | <1ç§’ | <2ç§’ | âœ… é”æˆ |
| IndexedDBä¿å­˜ | <200ms | <500ms | âœ… é”æˆ |
| Excelç”»åƒåŸ‹ã‚è¾¼ã¿ | <3ç§’/50ä»¶ | <5ç§’ | âœ… é”æˆ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ã‚¨ãƒª | <50ms | <100ms | âœ… é”æˆ |

### 9.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡
- **LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡**: 65%+ï¼ˆç›®æ¨™: 50%+ï¼‰ âœ…
- **è¨ˆç®—çµæœå†åˆ©ç”¨**: å®Ÿè¡Œæ™‚é–“70%å‰Šæ¸› âœ…
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: <50MBï¼ˆ94ç¤¾+5åˆ†æ+ç”»åƒãƒ‡ãƒ¼ã‚¿ï¼‰ âœ…

---

**æœ€çµ‚æ›´æ–°**: 2025-07-13  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.0  
**å®Ÿè£…çŠ¶æ³**: Phase 3å®Œäº†ï¼ˆ5ã¤ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†ææ©Ÿèƒ½ + Visual Analytics Galleryï¼‰  
**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: 94ç¤¾è¦æ¨¡ã§<1ç§’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€Visual Analyticsçµ±åˆæ¸ˆã¿  
**æ¬¡æœŸãƒ•ã‚§ãƒ¼ã‚º**: Phase 4ï¼ˆAI-powered insights and enterprise featuresï¼‰