# スコア算出アルゴリズム仕様書

## 概要

MVV分析システムにおける各種スコア算出のアルゴリズムと計算ロジックを詳述します。

## 1. 独自性分析スコア (Uniqueness Score)

### 1.1 概要
企業のMVV（Mission, Vision, Values）の独自性を多角的に評価するスコアリングシステム。4つの独立した指標を組み合わせて総合的な独自性を算出します。

### 1.2 総合スコア計算式
```
独自性スコア = 基本独自性 × 0.3 + 業界相対独自性 × 0.4 + クロス業界独自性 × 0.2 + 希少性スコア × 0.1
```

### 1.3 各構成要素の詳細

#### 1.3.1 基本独自性 (Base Uniqueness: 30%)
**計算方法:**
```
基本独自性 = 1 - 平均類似度
平均類似度 = Σ(対全企業類似度) / (総企業数 - 1)
```

**説明:**
- 対象企業と他のすべての企業との埋め込みベクトル類似度の平均値
- コサイン類似度を使用 (範囲: 0-1)
- 値が高いほど他社との差別化が図れている

#### 1.3.2 業界相対独自性 (Industry-Relative Uniqueness: 40%)
**計算方法:**
```
業界相対独自性 = Z-score正規化(同業界内平均類似度)
Z-score = (x - μ) / σ
正規化後 = (Z-score + 3) / 6  // [-3, 3] → [0, 1]にマッピング
```

**説明:**
- 同一業界内での相対的な位置づけを評価
- 業界平均からの標準偏差を基準とした正規化
- 業界内でのユニークさを定量化

#### 1.3.3 クロス業界独自性 (Cross-Industry Uniqueness: 20%)
**計算方法:**
```
クロス業界独自性 = 他業界企業との平均類似度の逆数
= 1 - Σ(他業界企業との類似度) / 他業界企業数
```

**説明:**
- 異なる業界の企業との類似度を評価
- 業界を超えた独自性を測定
- イノベーションや差別化の可能性を示唆

#### 1.3.4 希少性スコア (Rarity Score: 10%)
**計算方法:**
```
希少性スコア = 1 - (高頻度キーワード比率)
高頻度キーワード比率 = 高頻度キーワード数 / 総キーワード数
高頻度キーワード = 出現頻度 >= 閾値(5回以上)のキーワード
```

**説明:**
- MVVテキストに含まれる希少なキーワードの割合
- TinySegmenterによる形態素解析結果を使用
- 一般的でない表現の使用度を評価

### 1.4 実装詳細

#### データ構造
```typescript
interface UniquenessMetrics {
  baseUniqueness: number;        // 基本独自性 [0-1]
  industryUniqueness: number;    // 業界相対独自性 [0-1]
  crossIndustryUniqueness: number; // クロス業界独自性 [0-1]
  rarityScore: number;           // 希少性スコア [0-1]
  finalScore: number;            // 総合スコア [0-1]
}
```

#### パフォーマンス最適化
- 対称性を利用した類似度計算の最適化
- 業界統計の事前計算とキャッシュ
- LRUキャッシュによる計算結果の保存

## 2. 品質評価スコア (Quality Assessment Score)

### 2.1 概要
MVVステートメントの品質を客観的に評価するルールベースシステム。明確性、具体性、実行可能性の3つの観点から評価します。

### 2.2 評価項目と配点

#### 2.2.1 明確性 (Clarity: 40%)
**評価基準:**
- 文字数適正性 (10点): 20-200文字の範囲内
- 専門用語バランス (10点): 過度な専門用語の使用を減点
- 読みやすさ (10点): 句読点の適切な使用
- 曖昧表現の回避 (10点): 「など」「等」の過度な使用を減点

#### 2.2.2 具体性 (Specificity: 35%)
**評価基準:**
- 数値・期限の明示 (15点): 具体的な数値目標の言及
- 業界固有性 (10点): 業界特有のキーワードの含有
- 行動指向性 (10点): 動詞の適切な使用

#### 2.2.3 実行可能性 (Actionability: 25%)
**評価基準:**
- 現実性 (10点): 非現実的な表現の回避
- 測定可能性 (10点): 成果測定の可能性
- 時間軸の明示 (5点): 時間的概念の言及

### 2.3 計算アルゴリズム

```typescript
function calculateQualityScore(text: string, type: MVVType): QualityMetrics {
  const clarity = assessClarity(text);      // 40点満点
  const specificity = assessSpecificity(text, type); // 35点満点  
  const actionability = assessActionability(text);   // 25点満点
  
  const totalScore = clarity + specificity + actionability; // 100点満点
  const normalizedScore = totalScore / 100; // [0-1]に正規化
  
  return {
    clarity: clarity / 40,
    specificity: specificity / 35, 
    actionability: actionability / 25,
    totalScore: normalizedScore
  };
}
```

### 2.4 ベンチマーク基準

| スコア範囲 | 評価 | 説明 |
|------------|------|------|
| 0.8-1.0 | 優秀 | 非常に質の高いMVVステートメント |
| 0.6-0.79 | 良好 | 一般的なビジネスレベル |
| 0.4-0.59 | 改善推奨 | 具体性や明確性に課題 |
| 0.0-0.39 | 要改善 | 大幅な見直しが必要 |

## 3. ポジショニングマップ座標計算

### 3.1 多次元尺度法 (MDS: Multidimensional Scaling)

#### 3.1.1 アルゴリズム概要
企業間の類似度距離を2次元平面上にマッピングする最適化アルゴリズム。

#### 3.1.2 距離マトリックス生成
```
距離[i,j] = 1 - 類似度[i,j]
類似度[i,j] = コサイン類似度(embeddings[i], embeddings[j])
```

#### 3.1.3 座標最適化プロセス
1. **初期配置**: 円形配置による決定論的初期化
2. **反復最適化**: ストレス関数最小化 (30回反復)
3. **力制限**: 発散防止のための力の制限 (±0.1)
4. **座標正規化**: [-80, 80]範囲への正規化

#### 3.1.4 軸の意味
- **X軸**: MVV類似度の第1主成分 (独特性 ↔ 一般性)
- **Y軸**: MVV類似度の第2主成分 (伝統性 ↔ 革新性)

## 4. トレンド分析

### 4.1 キーワード抽出
**使用技術**: TinySegmenter (日本語形態素解析)

**フィルタリング条件**:
- 最小文字数: 2文字以上
- 除外語彙: 助詞、助動詞、一般的な接続詞
- 数字のみの語彙を除外
- ひらがなのみの語彙を除外

### 4.2 頻度分析
**指標**:
- 絶対頻度: キーワードの出現回数
- 相対頻度: 総キーワード数に対する比率
- 業界固有度: 特定業界での集中度
- 企業分布: キーワードを使用する企業数

## 5. パフォーマンス最適化

### 5.1 計算効率化
- **対称性活用**: 類似度マトリックスの上三角のみ計算
- **プログレッシブ計算**: 段階的な精度向上
- **LRUキャッシュ**: 計算結果の効率的な保存

### 5.2 メモリ最適化
- **遅延評価**: 必要時のみ計算実行
- **バッチ処理**: 複数企業の一括処理
- **ガベージコレクション**: 不要なデータの自動削除

---

**最終更新**: 2025-07-11  
**バージョン**: 1.0  
**実装状況**: 本番環境稼働中