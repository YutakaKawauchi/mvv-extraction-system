# Visual Analytics Gallery æŠ€è¡“è¨­è¨ˆæ›¸

**æœ€çµ‚æ›´æ–°**: 2025-07-13  
**Phase**: 3å®Œäº†ï¼ˆVisual Analytics Gallery with Excel Integrationï¼‰

## æ¦‚è¦

Visual Analytics Galleryã¯ã€MVVåˆ†æã‚·ã‚¹ãƒ†ãƒ ã®5ã¤ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æç”»é¢ã‚’é«˜å“è³ªã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ã—ã¦ä¿å­˜ã—ã€Professional Excel Exportã¨çµ±åˆã™ã‚‹é©æ–°çš„æ©Ÿèƒ½ã§ã™ã€‚AIåˆ†æçµæœã‚’è¦–è¦šçš„ãªå½¢å¼ã§æ°¸ç¶šåŒ–ã—ã€ãƒ“ã‚¸ãƒã‚¹ãƒ¬ãƒãƒ¼ãƒˆã«çµ±åˆã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿åˆ†æã®ä¾¡å€¤ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚

## è¨­è¨ˆç›®æ¨™

### âœ… é”æˆæ¸ˆã¿ç›®æ¨™
1. **é«˜å“è³ªã‚­ãƒ£ãƒ—ãƒãƒ£**: 2100Ã—1350pxé«˜è§£åƒåº¦ã§ã®ãƒ”ã‚¯ã‚»ãƒ«ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãªã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
2. **æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: IndexedDBã«ã‚ˆã‚‹ãƒ–ãƒ©ã‚¦ã‚¶å†…æ°¸ç¶šåŒ–ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãªã—ï¼‰
3. **TabIDåˆ†é¡**: åˆ†æã‚¿ã‚¤ãƒ—åˆ¥ã®è‡ªå‹•æ•´ç†ï¼ˆfinder, trends, wordcloud, positioning, uniqueness, qualityï¼‰
4. **Excelçµ±åˆ**: ãƒãƒ«ãƒã‚·ãƒ¼ãƒˆExcelãƒ¬ãƒãƒ¼ãƒˆã¸ã®ç”»åƒåŸ‹ã‚è¾¼ã¿
5. **ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§**: Node.jsä¾å­˜ãªã—ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Œçµå‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
6. **åŠ¹ç‡çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: LRUå‰Šé™¤ã«ã‚ˆã‚‹50ä»¶ä¸Šé™ç®¡ç†
7. **é«˜é€Ÿã‚¯ã‚¨ãƒª**: ãƒã‚¤ãƒ†ã‚£ãƒ–IndexedDB APIã«ã‚ˆã‚‹æœ€é©åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Visual Analytics Gallery                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Screenshot      â”‚  â”‚ Storage         â”‚  â”‚ Excel        â”‚ â”‚
â”‚  â”‚ Capture         â”‚  â”‚ Management      â”‚  â”‚ Integration  â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ html2canvas   â”‚  â”‚ â€¢ IndexedDB     â”‚  â”‚ â€¢ ExcelJS    â”‚ â”‚
â”‚  â”‚ â€¢ 2100Ã—1350px   â”‚  â”‚ â€¢ TabIDåˆ†é¡     â”‚  â”‚ â€¢ Multi-sheetâ”‚ â”‚
â”‚  â”‚ â€¢ PNG 95%å“è³ª   â”‚  â”‚ â€¢ LRUç®¡ç†       â”‚  â”‚ â€¢ Image embedâ”‚ â”‚
â”‚  â”‚ â€¢ DOM Capture   â”‚  â”‚ â€¢ Metadataåˆ†é›¢  â”‚  â”‚ â€¢ Base64å¤‰æ› â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                     â”‚    â”‚
â”‚           â–¼                     â–¼                     â–¼    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               Browser Runtime Environment               â”‚ â”‚
â”‚  â”‚ â€¢ Canvas API â€¢ IndexedDB API â€¢ Blob/ArrayBuffer       â”‚ â”‚
â”‚  â”‚ â€¢ File API   â€¢ DOM Selection â€¢ Base64 Processing      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
   â†“
2. AIåˆ†æç”»é¢è¡¨ç¤º
   â†“
3. ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ (html2canvas)
   â†“
4. ç”»åƒãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ (PNG Base64)
   â†“
5. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä½œæˆ (TabID, timestamp, etc.)
   â†“
6. IndexedDBä¿å­˜ (åˆ†é›¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)
   â†“
7. UIæ›´æ–° (ã‚®ãƒ£ãƒ©ãƒªãƒ¼è¡¨ç¤º)
   â†“
8. Excelçµ±åˆæ™‚ (TabIDåˆ¥ã‚°ãƒ«ãƒ¼ãƒ—åŒ–)
   â†“
9. Base64â†’ArrayBufferå¤‰æ› (ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›)
   â†“
10. ExcelJSãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯åŸ‹ã‚è¾¼ã¿
```

## æŠ€è¡“ä»•æ§˜

### 1. ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£

#### 1.1 ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¨ãƒ³ã‚¸ãƒ³
```typescript
interface ScreenshotCapture {
  captureElement: (selector: string, options: CaptureOptions) => Promise<string>;
  optimizeQuality: (canvas: HTMLCanvasElement) => void;
  validateDimensions: (width: number, height: number) => boolean;
}

interface CaptureOptions {
  width: number;           // 2100px (4Kå¯¾å¿œé«˜è§£åƒåº¦)
  height: number;          // 1350px (16:10ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”)
  quality: number;         // 0.95 (PNGé«˜å“è³ª)
  format: 'png' | 'jpeg';  // PNGæ¨å¥¨ï¼ˆãƒ­ã‚¹ãƒ¬ã‚¹ï¼‰
  backgroundColor: string; // '#ffffff' (ç™½èƒŒæ™¯)
  scale: number;           // 1.0 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚±ãƒ¼ãƒ«)
  logging: boolean;        // true (è©³ç´°ãƒ­ã‚°)
}
```

#### 1.2 å®Ÿè£…è©³ç´°
```typescript
class ScreenshotCaptureService {
  async captureAnalysisScreen(tabId: string, name: string): Promise<boolean> {
    try {
      const targetElement = document.querySelector('#analysis-container');
      if (!targetElement) {
        throw new Error('ã‚­ãƒ£ãƒ—ãƒãƒ£å¯¾è±¡è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }

      // html2canvasã«ã‚ˆã‚‹é«˜å“è³ªã‚­ãƒ£ãƒ—ãƒãƒ£
      const canvas = await html2canvas(targetElement, {
        width: 2100,
        height: 1350,
        scale: 1,
        backgroundColor: '#ffffff',
        useCORS: true,
        allowTaint: false,
        imageTimeout: 15000,
        logging: false
      });

      // PNGå½¢å¼ã§é«˜å“è³ªå‡ºåŠ›
      const base64Data = canvas.toDataURL('image/png', 0.95);
      
      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä½œæˆ
      const metadata: ScreenshotMetadata = {
        id: `screenshot_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        timestamp: Date.now(),
        name: name || `${tabId}_${new Date().toISOString().split('T')[0]}`,
        description: `${this.getTabDisplayName(tabId)}åˆ†æçµæœ`,
        tabId: tabId,
        width: canvas.width,
        height: canvas.height,
        size: this.calculateBase64Size(base64Data)
      };

      // åˆ†é›¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      await this.storageService.saveScreenshot(metadata, base64Data);
      
      return true;
    } catch (error) {
      console.error('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¨ãƒ©ãƒ¼:', error);
      return false;
    }
  }

  private calculateBase64Size(base64Data: string): number {
    // Base64æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°è¨ˆç®—
    const base64 = base64Data.split(',')[1];
    return Math.round((base64.length * 3) / 4);
  }
}
```

### 2. IndexedDBã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚·ã‚¹ãƒ†ãƒ 

#### 2.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
```typescript
interface ScreenshotDatabase {
  version: 1;
  stores: {
    screenshots: {
      keyPath: 'id';
      indexes: [
        { name: 'timestamp', keyPath: 'timestamp' },
        { name: 'tabId', keyPath: 'tabId' },
        { name: 'name', keyPath: 'name' }
      ];
    };
    screenshotData: {
      keyPath: 'id';
      indexes: [];
    };
  };
}

interface ScreenshotMetadata {
  id: string;              // ä¸€æ„è­˜åˆ¥å­
  timestamp: number;       // ä½œæˆæ—¥æ™‚ (Unix timestamp)
  name: string;            // ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å
  description: string;     // èª¬æ˜
  tabId: string;           // åˆ†æã‚¿ãƒ–ID
  width: number;           // ç”»åƒå¹… (px)
  height: number;          // ç”»åƒé«˜ã• (px)
  size: number;            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º (bytes)
}

interface ScreenshotData {
  id: string;              // metadataã¨ã®é–¢é€£ä»˜ã‘
  data: string;            // Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ‡ãƒ¼ã‚¿
}
```

#### 2.2 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
```typescript
class ScreenshotStorageService {
  private db: IDBDatabase;
  private readonly MAX_SCREENSHOTS = 50;
  
  // åŠ¹ç‡çš„ãªTabIDåˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
  async countByTabId(tabId: string): Promise<number> {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction(['screenshots'], 'readonly');
      const store = transaction.objectStore('screenshots');
      const index = store.index('tabId');
      const request = index.count(tabId);
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  // é«˜é€ŸTabIDåˆ¥å–å¾—
  async getByTabId(tabId: string): Promise<ScreenshotMetadata[]> {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction(['screenshots'], 'readonly');
      const store = transaction.objectStore('screenshots');
      const index = store.index('tabId');
      const request = index.getAll(tabId);
      
      request.onsuccess = () => {
        const results = request.result.sort((a, b) => b.timestamp - a.timestamp);
        resolve(results);
      };
      request.onerror = () => reject(request.error);
    });
  }

  // LRUè‡ªå‹•å‰Šé™¤
  async maintainStorageLimit(): Promise<void> {
    const total = await this.getTotalCount();
    if (total > this.MAX_SCREENSHOTS) {
      const excess = total - this.MAX_SCREENSHOTS;
      await this.deleteOldestScreenshots(excess);
    }
  }

  private async deleteOldestScreenshots(count: number): Promise<void> {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction(['screenshots', 'screenshotData'], 'readwrite');
      const metadataStore = transaction.objectStore('screenshots');
      const dataStore = transaction.objectStore('screenshotData');
      const index = metadataStore.index('timestamp');
      
      // å¤ã„é †ã§ã‚«ãƒ¼ã‚½ãƒ«å–å¾—
      const request = index.openCursor();
      let deleted = 0;
      
      request.onsuccess = (event) => {
        const cursor = (event.target as IDBRequest).result;
        if (cursor && deleted < count) {
          const id = cursor.value.id;
          
          // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ãƒ‡ãƒ¼ã‚¿ã®ä¸¡æ–¹ã‚’å‰Šé™¤
          metadataStore.delete(id);
          dataStore.delete(id);
          
          deleted++;
          cursor.continue();
        } else {
          resolve();
        }
      };
      request.onerror = () => reject(request.error);
    });
  }

  // åŠ¹ç‡çš„ãªä¿å­˜ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä½¿ç”¨ï¼‰
  async saveScreenshot(metadata: ScreenshotMetadata, imageData: string): Promise<void> {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction(['screenshots', 'screenshotData'], 'readwrite');
      const metadataStore = transaction.objectStore('screenshots');
      const dataStore = transaction.objectStore('screenshotData');
      
      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ãƒ‡ãƒ¼ã‚¿ã‚’åŒæ™‚ä¿å­˜
      metadataStore.add(metadata);
      dataStore.add({ id: metadata.id, data: imageData });
      
      transaction.oncomplete = () => resolve();
      transaction.onerror = () => reject(transaction.error);
    });
    
    // ä¿å­˜å¾Œã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šé™ãƒã‚§ãƒƒã‚¯
    await this.maintainStorageLimit();
  }
}
```

### 3. Excelçµ±åˆã‚·ã‚¹ãƒ†ãƒ 

#### 3.1 ç”»åƒåŸ‹ã‚è¾¼ã¿å‡¦ç†
```typescript
class ExcelImageIntegration {
  // ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›Base64â†’ArrayBufferå¤‰æ›
  private base64ToArrayBuffer(base64: string): ArrayBuffer {
    // dataURL prefixã‚’é™¤å»
    const base64Data = base64.includes(',') ? base64.split(',')[1] : base64;
    
    // atob()ã§ãƒã‚¤ãƒŠãƒªæ–‡å­—åˆ—ã«å¤‰æ›
    const binaryString = atob(base64Data);
    const length = binaryString.length;
    const bytes = new Uint8Array(length);
    
    // 1æ–‡å­—ãšã¤ãƒã‚¤ãƒˆå€¤ã«å¤‰æ›
    for (let i = 0; i < length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    
    return bytes.buffer; // ExcelJSäº’æ›ã®ArrayBuffer
  }

  // TabIDåˆ¥ãƒãƒ«ãƒã‚·ãƒ¼ãƒˆç”Ÿæˆ
  async generateVisualAnalyticsSheets(workbook: ExcelJS.Workbook): Promise<void> {
    const screenshots = await this.storageService.getAllScreenshots();
    const groupedByTab = this.groupScreenshotsByTabId(screenshots);
    
    for (const [tabId, tabScreenshots] of groupedByTab) {
      if (tabScreenshots.length === 0) continue;
      
      await this.createTabSheet(workbook, tabId, tabScreenshots);
    }
  }

  private async createTabSheet(
    workbook: ExcelJS.Workbook, 
    tabId: string, 
    screenshots: ScreenshotMetadata[]
  ): Promise<void> {
    const sheetName = `Visual Analytics - ${this.getTabDisplayName(tabId)}`;
    const worksheet = workbook.addWorksheet(sheetName);
    
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
    worksheet.columns = [
      { header: 'åå‰', key: 'name', width: 25 },
      { header: 'ä½œæˆæ—¥æ™‚', key: 'timestamp', width: 20 },
      { header: 'èª¬æ˜', key: 'description', width: 30 },
      { header: 'ã‚µã‚¤ã‚º', key: 'size', width: 12 },
      { header: 'ç”»åƒ', key: 'image', width: 50 }
    ];

    let currentRow = 2; // ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¬¡ã®è¡Œã‹ã‚‰é–‹å§‹
    
    for (const screenshot of screenshots) {
      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡Œã®è¨­å®š
      worksheet.getCell(`A${currentRow}`).value = screenshot.name;
      worksheet.getCell(`B${currentRow}`).value = new Date(screenshot.timestamp);
      worksheet.getCell(`C${currentRow}`).value = screenshot.description;
      worksheet.getCell(`D${currentRow}`).value = `${Math.round(screenshot.size / 1024)}KB`;
      
      // ç”»åƒãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨åŸ‹ã‚è¾¼ã¿
      try {
        const imageData = await this.storageService.getScreenshotData(screenshot.id);
        if (imageData) {
          const imageBuffer = this.base64ToArrayBuffer(imageData);
          
          // ExcelJSã§ç”»åƒã‚’è¿½åŠ 
          const imageId = workbook.addImage({
            buffer: imageBuffer,
            extension: 'png',
          });
          
          // ç”»åƒã‚’æŒ‡å®šã‚»ãƒ«ã«é…ç½®ï¼ˆã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ç¶­æŒï¼‰
          worksheet.addImage(imageId, {
            tl: { col: 4, row: currentRow - 1 }, // Eåˆ—ã«é…ç½®
            ext: { width: 400, height: 300 }     // è¡¨ç¤ºã‚µã‚¤ã‚º
          });
          
          // ç”»åƒè¡Œã®é«˜ã•ã‚’èª¿æ•´
          worksheet.getRow(currentRow).height = 225; // 300pxç›¸å½“
        }
      } catch (error) {
        console.error(`ç”»åƒåŸ‹ã‚è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (${screenshot.id}):`, error);
        worksheet.getCell(`E${currentRow}`).value = 'ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';
      }
      
      currentRow++;
    }
    
    // ã‚·ãƒ¼ãƒˆå…¨ä½“ã®æ›¸å¼è¨­å®š
    worksheet.getRow(1).font = { bold: true };
    worksheet.autoFilter = 'A1:E1';
  }

  private groupScreenshotsByTabId(screenshots: ScreenshotMetadata[]): Map<string, ScreenshotMetadata[]> {
    const grouped = new Map<string, ScreenshotMetadata[]>();
    
    for (const screenshot of screenshots) {
      if (!grouped.has(screenshot.tabId)) {
        grouped.set(screenshot.tabId, []);
      }
      grouped.get(screenshot.tabId)!.push(screenshot);
    }
    
    // å„ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§æ™‚ç³»åˆ—ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
    for (const [tabId, group] of grouped) {
      group.sort((a, b) => b.timestamp - a.timestamp);
    }
    
    return grouped;
  }

  private getTabDisplayName(tabId: string): string {
    const displayNames = {
      'finder': 'é¡ä¼¼ä¼æ¥­æ¤œç´¢',
      'trends': 'ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ',
      'wordcloud': 'ãƒ¯ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¦ãƒ‰',
      'positioning': 'ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ãƒãƒƒãƒ—',
      'uniqueness': 'ç‹¬è‡ªæ€§åˆ†æ',
      'quality': 'å“è³ªè©•ä¾¡'
    };
    return displayNames[tabId] || tabId;
  }
}
```

### 4. UI/UXã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 4.1 ã‚®ãƒ£ãƒ©ãƒªãƒ¼UI
```typescript
export const VisualAnalyticsGallery: React.FC = () => {
  const [screenshots, setScreenshots] = useState<ScreenshotMetadata[]>([]);
  const [storageUsage, setStorageUsage] = useState<StorageInfo>();
  const [isCapturing, setIsCapturing] = useState(false);
  const [selectedTab, setSelectedTab] = useState<string>('all');

  // åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
  const loadScreenshots = useCallback(async () => {
    try {
      if (selectedTab === 'all') {
        const allScreenshots = await screenshotStorage.getAllScreenshots();
        setScreenshots(allScreenshots);
      } else {
        const tabScreenshots = await screenshotStorage.getByTabId(selectedTab);
        setScreenshots(tabScreenshots);
      }
      
      // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã®æ›´æ–°
      const usage = await screenshotStorage.getStorageUsage();
      setStorageUsage(usage);
    } catch (error) {
      console.error('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }, [selectedTab]);

  // ã‚­ãƒ£ãƒ—ãƒãƒ£å®Ÿè¡Œ
  const handleCapture = useCallback(async (tabId: string, name: string) => {
    setIsCapturing(true);
    try {
      const success = await screenshotCapture.captureAnalysisScreen(tabId, name);
      if (success) {
        await loadScreenshots(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        toast.success('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      } else {
        toast.error('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } finally {
      setIsCapturing(false);
    }
  }, [loadScreenshots]);

  // å‰Šé™¤å‡¦ç†
  const handleDelete = useCallback(async (id: string) => {
    try {
      await screenshotStorage.deleteScreenshot(id);
      await loadScreenshots();
      toast.success('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
    } catch (error) {
      console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      toast.error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  }, [loadScreenshots]);

  return (
    <div className="space-y-6">
      {/* ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */}
      <CaptureControls 
        onCapture={handleCapture}
        isCapturing={isCapturing}
        disabled={screenshots.length >= 50}
      />
      
      {/* ã‚¿ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
      <TabFilter 
        selectedTab={selectedTab}
        onTabChange={setSelectedTab}
        screenshots={screenshots}
      />
      
      {/* ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚°ãƒªãƒƒãƒ‰ */}
      <ScreenshotGrid 
        screenshots={screenshots}
        onDelete={handleDelete}
        onPreview={handlePreview}
      />
      
      {/* ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ */}
      <StorageUsageDisplay usage={storageUsage} />
      
      {/* Excelçµ±åˆãƒ‘ãƒãƒ« */}
      <ExcelIntegrationPanel screenshots={screenshots} />
    </div>
  );
};
```

#### 4.2 ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
```typescript
const CaptureControls: React.FC<CaptureControlsProps> = ({
  onCapture, 
  isCapturing, 
  disabled
}) => {
  const [customName, setCustomName] = useState('');
  const currentTabId = useAnalysisStore(state => state.activeTab);

  const handleQuickCapture = useCallback(() => {
    const defaultName = `${getTabDisplayName(currentTabId)}_${new Date().toLocaleDateString('ja-JP')}`;
    onCapture(currentTabId, customName || defaultName);
    setCustomName('');
  }, [currentTabId, customName, onCapture]);

  return (
    <Card className="p-4">
      <div className="flex items-center gap-4">
        <div className="flex-1">
          <Label htmlFor="screenshot-name">ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆåï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</Label>
          <Input
            id="screenshot-name"
            value={customName}
            onChange={(e) => setCustomName(e.target.value)}
            placeholder={`${getTabDisplayName(currentTabId)}åˆ†æçµæœ`}
            disabled={isCapturing}
          />
        </div>
        
        <Button
          onClick={handleQuickCapture}
          disabled={disabled || isCapturing}
          className="flex items-center gap-2"
        >
          {isCapturing ? (
            <>
              <Loader2 className="w-4 h-4 animate-spin" />
              ã‚­ãƒ£ãƒ—ãƒãƒ£ä¸­...
            </>
          ) : (
            <>
              <Camera className="w-4 h-4" />
              ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±
            </>
          )}
        </Button>
      </div>
      
      {disabled && (
        <Alert className="mt-3">
          <AlertCircle className="w-4 h-4" />
          <AlertDescription>
            ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šé™ï¼ˆ50ä»¶ï¼‰ã«é”ã—ã¦ã„ã¾ã™ã€‚å¤ã„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
          </AlertDescription>
        </Alert>
      )}
    </Card>
  );
};
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ã‚­ãƒ£ãƒ—ãƒãƒ£æœ€é©åŒ–
```typescript
// é«˜é€ŸåŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯
const optimizedCapture = {
  // éåŒæœŸå‡¦ç†ã«ã‚ˆã‚‹UIãƒ–ãƒ­ãƒƒã‚¯é˜²æ­¢
  async: true,
  
  // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›
  canvas: {
    willReadFrequently: true,
    alpha: false
  },
  
  // æç”»æœ€é©åŒ–
  rendering: {
    useCORS: true,
    allowTaint: false,
    foreignObjectRendering: false
  },
  
  // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
  timeout: 15000
};
```

### 2. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–
```typescript
// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨ã«ã‚ˆã‚‹é«˜é€Ÿã‚¯ã‚¨ãƒª
const optimizedQueries = {
  // TabIDåˆ¥ã‚«ã‚¦ãƒ³ãƒˆï¼ˆO(log n)ï¼‰
  countByTabId: 'index.count()',
  
  // æ™‚ç³»åˆ—ã‚½ãƒ¼ãƒˆï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨ï¼‰
  sortByTimestamp: 'index.openCursor(range, direction)',
  
  // ãƒãƒƒãƒå‰Šé™¤ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
  batchDelete: 'transaction.objectStore().delete()'
};
```

### 3. ãƒ¡ãƒ¢ãƒªç®¡ç†
```typescript
class MemoryManager {
  // Base64ãƒ‡ãƒ¼ã‚¿ã®ãƒ¡ãƒ¢ãƒªåŠ¹ç‡è¨ˆç®—
  calculateMemoryUsage(base64Data: string): number {
    // Base64ã¯å…ƒãƒ‡ãƒ¼ã‚¿ã®133%ã®ã‚µã‚¤ã‚º
    const actualSize = (base64Data.length * 3) / 4;
    return actualSize;
  }
  
  // ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ¨å¥¨
  suggestCleanup(): boolean {
    const usage = this.getTotalMemoryUsage();
    return usage > 50 * 1024 * 1024; // 50MBè¶…é
  }
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 1. ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¨ãƒ©ãƒ¼
```typescript
class CaptureErrorHandler {
  async handleCaptureError(error: Error): Promise<CaptureResult> {
    if (error.name === 'SecurityError') {
      return {
        success: false,
        error: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ã«ã‚ˆã‚Šã‚­ãƒ£ãƒ—ãƒãƒ£ã§ãã¾ã›ã‚“ï¼ˆCORSï¼‰',
        suggestions: ['ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„', 'ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„']
      };
    }
    
    if (error.name === 'QuotaExceededError') {
      return {
        success: false,
        error: 'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™',
        suggestions: ['å¤ã„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¦ãã ã•ã„', 'ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„']
      };
    }
    
    if (error.message.includes('html2canvas')) {
      return {
        success: false,
        error: 'ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
        suggestions: ['å¯¾è±¡è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„', 'ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„']
      };
    }
    
    return {
      success: false,
      error: 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
      suggestions: ['å†è©¦è¡Œã—ã¦ãã ã•ã„', 'ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã—ã¦ãã ã•ã„']
    };
  }
}
```

### 2. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼
```typescript
class StorageErrorHandler {
  async handleStorageError(error: DOMException): Promise<StorageResult> {
    switch (error.name) {
      case 'QuotaExceededError':
        await this.autoCleanup();
        return { success: false, recovered: true, message: 'å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å‰Šé™¤ã—ã¾ã—ãŸ' };
        
      case 'InvalidStateError':
        await this.reinitializeDatabase();
        return { success: false, recovered: true, message: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å†åˆæœŸåŒ–ã—ã¾ã—ãŸ' };
        
      case 'DataError':
        return { success: false, recovered: false, message: 'ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ã¾ã™' };
        
      default:
        return { success: false, recovered: false, message: 'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' };
    }
  }
}
```

## ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§

### ã‚µãƒãƒ¼ãƒˆå¯¾è±¡
- **Chrome**: 80+ âœ…
- **Firefox**: 75+ âœ…  
- **Safari**: 13+ âœ…
- **Edge**: 80+ âœ…

### å¿…è¦ãªAPI
- Canvas API
- IndexedDB
- Blob/ArrayBuffer
- atob/btoa
- html2canvas (external library)

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥
```typescript
class CompatibilityChecker {
  checkSupport(): CompatibilityResult {
    const support = {
      canvas: 'HTMLCanvasElement' in window,
      indexedDB: 'indexedDB' in window,
      blob: 'Blob' in window,
      base64: 'atob' in window && 'btoa' in window
    };
    
    const unsupported = Object.entries(support)
      .filter(([key, supported]) => !supported)
      .map(([key]) => key);
      
    return {
      isSupported: unsupported.length === 0,
      unsupportedFeatures: unsupported,
      suggestions: this.getSuggestions(unsupported)
    };
  }
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. CORSå¯¾å¿œ
- html2canvasã®useCORSè¨­å®š
- å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®allowTaintåˆ¶å¾¡
- åŒä¸€ã‚ªãƒªã‚¸ãƒ³ãƒãƒªã‚·ãƒ¼æº–æ‹ 

### 2. ãƒ‡ãƒ¼ã‚¿ä¿è­·
- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã¿ä½¿ç”¨ï¼ˆã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—ï¼‰
- æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å‰Šé™¤
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½æ´»ç”¨

### 3. ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
- 50ä»¶ä¸Šé™ã«ã‚ˆã‚‹å®¹é‡åˆ¶å¾¡
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
- è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½

## é‹ç”¨ãƒ»ä¿å®ˆ

### 1. ç›£è¦–æŒ‡æ¨™
```typescript
interface Metrics {
  captureSuccess: number;      // ã‚­ãƒ£ãƒ—ãƒãƒ£æˆåŠŸç‡
  averageCaptureTime: number;  // å¹³å‡ã‚­ãƒ£ãƒ—ãƒãƒ£æ™‚é–“
  storageUsage: number;        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡
  errorRate: number;           // ã‚¨ãƒ©ãƒ¼ç‡
  cleanupFrequency: number;    // è‡ªå‹•å‰Šé™¤é »åº¦
}
```

### 2. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ã‚­ãƒ£ãƒ—ãƒãƒ£å¤±æ•—ã®è¨ºæ–­ãƒ„ãƒ¼ãƒ«
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹ã®ç¢ºèªæ©Ÿèƒ½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®åé›†

### 3. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥
- ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»
- å¾Œæ–¹äº’æ›æ€§ã®ç¶­æŒ
- æ®µéšçš„æ©Ÿèƒ½è¿½åŠ 

## å°†æ¥ã®æ‹¡å¼µè¨ˆç”»

### Phase 4å€™è£œæ©Ÿèƒ½
1. **å‹•ç”»ã‚­ãƒ£ãƒ—ãƒãƒ£**: åˆ†æãƒ—ãƒ­ã‚»ã‚¹ã®éŒ²ç”»æ©Ÿèƒ½
2. **ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ**: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹é–“ã§ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå…±æœ‰
3. **AIè‡ªå‹•å‘½å**: åˆ†æå†…å®¹ã«åŸºã¥ã„ãŸè‡ªå‹•ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
4. **ã‚«ã‚¹ã‚¿ãƒ æ³¨é‡ˆ**: ã‚­ãƒ£ãƒ—ãƒãƒ£ç”»åƒã¸ã®æ³¨é‡ˆãƒ»ç·¨é›†æ©Ÿèƒ½
5. **PDFçµ±åˆ**: Excelä»¥å¤–ã®å½¢å¼ã§ã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## çµè«–

Visual Analytics Galleryã¯ã€AIåˆ†æçµæœã®è¦–è¦šçš„æ°¸ç¶šåŒ–ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿åˆ†æã®ä¾¡å€¤ã‚’æœ€å¤§åŒ–ã™ã‚‹é©æ–°çš„ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### âœ… æŠ€è¡“çš„æˆæœ
- **é«˜å“è³ªã‚­ãƒ£ãƒ—ãƒãƒ£**: 2100Ã—1350pxé«˜è§£åƒåº¦ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
- **åŠ¹ç‡çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: IndexedDBæœ€é©åŒ–ã«ã‚ˆã‚‹é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹
- **Excelçµ±åˆ**: ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›ã®ç”»åƒåŸ‹ã‚è¾¼ã¿æŠ€è¡“
- **å„ªã‚ŒãŸUX**: ç›´æ„Ÿçš„ãªæ“ä½œã¨è‡ªå‹•ç®¡ç†

### ğŸš€ ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤
- **åˆ†æçµæœã®æ°¸ç¶šåŒ–**: ä¸€æ™‚çš„ãªç”»é¢ã‚’æ’ä¹…çš„ãªè³‡ç”£ã«å¤‰æ›
- **ãƒ¬ãƒãƒ¼ãƒˆå“è³ªå‘ä¸Š**: è¦–è¦šçš„ãªåˆ†æçµæœã‚’ãƒ“ã‚¸ãƒã‚¹æ–‡æ›¸ã«çµ±åˆ
- **åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†**: è‡ªå‹•åˆ†é¡ã¨æ•´ç†ã«ã‚ˆã‚‹é‹ç”¨è² è·è»½æ¸›
- **ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ”¯æ´**: é«˜å“è³ªãªåˆ†æç”»åƒã®å³åº§åˆ©ç”¨

Phase 3å®Œäº†ã«ã‚ˆã‚Šã€Visual Analytics Galleryã¯ä¼æ¥­åˆ†æãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å·®åˆ¥åŒ–è¦å› ã¨ãªã‚Šã€Phase 4ã§ã®æ›´ãªã‚‹é€²åŒ–ã®åŸºç›¤ã‚’æä¾›ã—ã¾ã™ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2025-07-13  
**Phase**: 3å®Œäº† (Visual Analytics Gallery with Excel Integration)  
**æ¬¡æœŸè¨ˆç”»**: Phase 4 (AI-powered insights and enterprise features)